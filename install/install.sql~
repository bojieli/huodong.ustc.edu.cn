-- Gewu INSTALL SQL DUMP
-- 2011-07-25
DROP TABLE IF EXISTS common_object;
CREATE TABLE common_object (
	`name` varchar(255) NOT NULL DEFAULT '',
	`path` varchar(255) NOT NULL DEFAULT '',
	`parent` varchar(255) NOT NULL DEFAULT '',
	`author` int(10) NOT NULL DEFAULT '0',
	`tag` varchar(255) NOT NULL DEFAULT '',
	`class_name` varchar(255) NOT NULL DEFAULT '',
	`extend_class` varchar(255) NOT NULL DEFAULT '',
	`priv_value` smallint(3) NOT NULL DEFAULT '755',
	`priv_admin` varchar(255) NOT NULL DEFAULT '0',
	`priv_user` varchar(255) NOT NULL DEFAULT '0',
	`priv_list` text NOT NULL,
	`whitelist` text NOT NULL,
	`blacklist` text NOT NULL,
	`event_handlers` text NOT NULL,
	`template` text NOT NULL,
	`javascript` text NOT NULL,
	`css` text NOT NULL,
	`script` text NOT NULL,
	`credit` text NOT NULL,
	`note` text NOT NULL,
	`draft` text NOT NULL,
	`inbox` text NOT NULL,
	`title` text NOT NULL,
	`content` text NOT NULL,
	`rate` int(10) NOT NULL default '0',
	`select_count` int(10) NOT NULL DEFAULT '0',
	`read_count` int(10) NOT NULL DEFAULT '0',
	`update_count` int(10) NOT NULL DEFAULT '0',
	`child_count` int(10) NOT NULL DEFAULT '0',
	`sub_object_count` int(10) NOT NULL DEFAULT '0',
	`next_child_id` int(10) NOT NULL DEFAULT '1',
	`create_time` int(10) NOT NULL DEFAULT '0',
	`modify_time` int(10) NOT NULL DEFAULT '0',
	`access_time` int(10) NOT NULL DEFAULT '0',
	PRIMARY KEY (`path`)
);

DROP TABLE IF EXISTS common_attribute;
CREATE TABLE common_attribute (
	`path` varchar(255) NOT NULL DEFAULT '',
	`name` varchar(255) NOT NULL DEFAULT '',
	`value` text NOT NULL,
	PRIMARY KEY (`path`, `name`)
);

DROP TABLE IF EXISTS common_search;
CREATE TABLE common_search (
	`path` varchar(255) NOT NULL DEFAULT '',
	`page_rank` int(10) NOT NULL DEFAULT '0',
	`search_index` text,
	PRIMARY KEY (`path`)
);

DROP TABLE IF EXISTS common_user;
CREATE TABLE common_user (
	`id` int(10) unsigned NOT NULL AUTO_INCREMENT,
	`login_name` varchar(255) NOT NULL DEFAULT '',
	`password` varchar(255) NOT NULL DEFAULT '',
	`salt` varchar(255) NOT NULL DEFAULT '',
	`realname` varchar(255) NOT NULL DEFAULT '',
	`nickname` varchar(255) NOT NULL DEFAULT '',
	`register_time` int(10) NOT NULL DEFAULT '0',
	`register_ip` varchar(15) NOT NULL DEFAULT '',
	`login_time` int(10) NOT NULL DEFAULT '0',
	`login_ip` varchar(15) NOT NULL DEFAULT '',
	`login_count` int(10) NOT NULL DEFAULT '0',
	`online_time` int(10) NOT NULL DEFAULT '0',
	`friend` text NOT NULL,
	`listen` text NOT NULL,
	`listener` text NOT NULL,
	`include` text NOT NULL,
	`profile` text NOT NULL,
	`settings` text NOT NULL,
	`public_object` varchar(255) NOT NULL DEFAULT '',
	`private_object` varchar(255) NOT NULL DEFAULT '',
	PRIMARY KEY (`id`)
);

DROP TABLE IF EXISTS common_group;
CREATE TABLE common_group (
	`id` int(10) NOT NULL AUTO_INCREMENT,
	`name` varchar(255) NOT NULL DEFAULT '',
	`parent` varchar(255) NOT NULL DEFAULT '',
	`create_time` int(10) NOT NULL DEFAULT '0',
	`create_user` int(10) NOT NULL DEFAULT '0',
	`priv` smallint(3) NOT NULL DEFAULT '744',
	`admin` text NOT NULL,
	`agent` text NOT NULL,
	`member` text NOT NULL,
	`friend` text NOT NULL,
	`listen` text NOT NULL,
	`listener` text NOT NULL,
	`include` text NOT NULL,
	`profile` text NOT NULL,
	`settings` text NOT NULL,
	`public_object` varchar(255) NOT NULL DEFAULT '',
	`private_object` varchar(255) NOT NULL DEFAULT '',
	PRIMARY KEY (`id`)
);

DROP TABLE IF EXISTS common_message;
CREATE TABLE common_message (
	`source` varchar(255) NOT NULL DEFAULT '',
	`target` varchar(255) NOT NULL DEFAULT '',
	`time` int(10) NOT NULL DEFAULT '0',
	`content` text NOT NULL,
	`emergency` tinyint(1) NOT NULL DEFAULT '0',
	`report` tinyint(1) NOT NULL DEFAULT '0'
);

-- install initial data

INSERT INTO common_user SET `login_name`='admin', `password`='admin';
INSERT INTO common_object SET `path`='/', `parent`='/', `class_name`='root', `priv_value`='755', `priv_admin`='1';
INSERT INTO common_object SET `path`='/admin', `parent`='/', `class_name`='admin', `priv_value`='744', `priv_admin`='1';
INSERT INTO common_object SET `path`='/user/admin', `parent`='/user', `class_name`='admin', `priv_value`='700', `priv_admin`='1';
INSERT INTO common_object SET `path`='/user', `parent`='/user', `class_name`='admin', `priv_value`='755', `priv_admin`='1';