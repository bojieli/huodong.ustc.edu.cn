<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<script src="/static/jquery.js" type="text/javascript"></script>
<script src="/static/jquery.form.js" type="text/javascript"></script>
<script src="/static/jquery.Jcrop.js"></script>
<link href="/static/css1.css" type="text/css" rel="stylesheet" />

<script language="Javascript">
$(function(){
	$('#uploadForm').ajaxForm({
                complete: function(data) {
                        var info = eval('(' + data.responseText + ')');
                        if(info.status=='1')
                        {
                                var img_src = "/{$avatar_path}"+info.info;
                                var img_src_small = "/{$avatar_path}small_"+info.info;
                                $("#avatar").attr("src",img_src);
                                $("#avatar_small").attr("src",img_src_small);
                        }
                        else
                        {
                                alert(info.info);
                        }
                }
     });
			$('#cropbox').Jcrop({
					aspectRatio: 1,
					onSelect: updateCoords
				});

			});

			function updateCoords(c)
			{
				$('#x').val(c.x);
				$('#y').val(c.y);
				$('#w').val(c.w);
				$('#h').val(c.h);
			};

			function checkCoords()
			{
				if (parseInt($('#w').val())) return true;
				alert('Please select a crop region then press submit.');
				return false;
			};

		</script>

	</head>

	<body>

	<div id="outer">
	<div class="jcExample">
	<div class="article">

		<h1>Jcrop - Crop Behavior</h1>
		<form  method="post" action="/User/avatarUpload" enctype="multipart/form-data" id="uploadForm" >
            <input type="file" name="avatar" id="avatar"><input type="submit" value="保存">
        </form>
		<img src="" id="avatar" />

		<!-- This is the form that our event handler fills -->
		<form action="crop.php" method="post" onsubmit="return checkCoords();">
			<input type="hidden" id="x" name="x" />
			<input type="hidden" id="y" name="y" />
			<input type="hidden" id="w" name="w" />
			<input type="hidden" id="h" name="h" />
			<input type="submit" value="Crop Image" />
		</form>

		<p>
			<b>An example server-side crop script.</b> Hidden form values
			are set when a selection is made. If you press the <i>Crop Image</i>
			button, the form will be submitted and a 150x150 thumbnail will be
			dumped to the browser. Try it!
		</p>

	</div>
	</div>
	</div>
	</body>

</html>