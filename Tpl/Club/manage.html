<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="/static/css1.css" type="text/css" rel="stylesheet" />
<script src="/static/jquery.js" type="text/javascript"></script>
<link href="/static/shetuanxianshi.css" type="text/css" rel="stylesheet" />
<title>社团成员管理</title>
</head>

<body>	
<include file="Public:headnav" />

<notempty name="club.isadmin">
<script>
    function ajaxChangeTitle(uid, priv, title) {
        if (title.length < 1)
		return;
    	$.ajax({
		url: "/Club/changeTitle",
		data: {uid: uid, gid: <?=$club['gid']?>, title: title, priv: priv}
	}).done(function(obj){
		dom = $("#stcy"+uid).children('.stcycell2').children('.stzhiwu');
		dom.children('img').attr("src", "/static/images/aa"+
			function() {
			switch(priv) {
			case 'admin': return 1;
			case 'manager': return 2;
			case 'member': return 3;
			case 'inactive': return 4;
			default: return 4;
			}
			}()
			+".png"
		);
		dom.children('.stzhiwumc').html(title);
	});
    }
</script>		
</notempty>

<notempty name="club.ismanager">
<?php
$showPager = function() use($club) {
	if ($club['ismanager'])
	if ($club['memberCount'] > 20) {
?>
<div class="pager">
<?php	$num = floor(($club['memberCount'] + 19) / 20);
	for ($page=1; $page<=$num; $page++) { ?>
<a href="/Club/manage?gid=<?=$club['gid']?>&start=<?=($page-1)*20?>"><?=$page?></a>
<?php	} ?>
</div>
<?php
	}
};
?>
</notempty>

<div id="stmain">
<include file="introHeaderin" />
	<div class="stcon1">
    	<div class="stcylb">会员<span class="stnotice1">（为保护隐私，普通成员无法看到除了社团管理者之外的会员的联系方式）</span></div>
        <div class="stcyleft">
<notempty name="club.ismanager">
	<?php $showPager(); ?>
</notempty>
	    <volist name="members" id="member">
            <div class="stcycell" id="stcy{$member.uid}">
            	<div class="stcycell1"><img width="90" height="90" src="/{$member.avatar}"></div>
                <div class="stcycell2">
		<?php
		$priv2num = function($priv) {
			switch ($priv) {
			case 'admin': return 1;
			case 'manager': return 2;
			case 'member': return 3;
			default: return 4;
			}
		};
		$member['privlevel'] = $priv2num($member['priv']);
		?>
                    <div class="stzhiwu"><img src="/static/images/aa{$member.privlevel}.png" />
		    <div class="stzhiwumc">{$member.title}</div>
		    
		    <notempty name="club.isadmin">
	    	    <div class="stzhiwusz">任命为：
                        <select onchange="ajaxChangeTitle({$member.uid}, this.options[this.selectedIndex].getAttribute('priv'), this.options[this.selectedIndex].getAttribute('title'))">
                        <option priv="" title="" selected="selected">------</option>
            
			<option priv="admin" title="会长" style="color:#F00;">会长</option>
			<option priv="admin" title="社长" style="color:#F00;">社长</option>
			<option priv="admin" title="主席" style="color:#F00;">主席</option>
            <option priv="admin" title="队长" style="color:#F00;">队长</option>
			
                        <option priv="" title="">------</option>
                        <option priv="manager" title="副会长" style="color:#F93">副会长</option>
						<option priv="manager" title="副社长" style="color:#F93">副社长</option>
						<option priv="manager" title="副主席" style="color:#F93">副主席</option>
                        <option priv="manager" title="部长" style="color:#F93">部长</option>
                        <option priv="manager" title="副部长" style="color:#F93">副部长</option>
                        <option priv="manager" title="项目组长" style="color:#F93">项目组长</option>
                        <option priv="manager" title="活动负责人" style="color:#F93">活动负责人</option>
                        
                        <option priv="" title="" >------</option>
                        <option priv="member" title="会员" style="color:#09F;">普通会员</option>
                       
                        <option priv="" title="" >------</option>
			<option priv="inactive" title="待审核">待审核</option>
                	</select>
                    </div>
		    </notempty>

		    <notempty name="club.isSchoolAdmin">
		    <div class="stsetowner">
		    <a href="/Club/addOwnerSubmit?gid={$club.gid}&owner={$member.uid}">设为会长</a>
		    </div>
		    </notempty>

		    </div>
                    <div class="stcyxx"><span class="<?=$member['gender'] ? 'boy' : 'girl' ?>name">{$member.realname}</span>：<br/>
		    {$member.dept} {$member.grade}级 {$member.education}<br/>

		    <if condition="$member[priv] == 'admin' || ($member[priv] == 'manager' && $club[isin]) || $club[ismanager]">
		         <notempty name="club.ismanager">
		            <notempty name="member.student_no">
			    <span style="color:#CCC;">学号:</span> {$member.student_no}
			    </notempty>
			 </notempty>
			    <notempty name="member.qq">
			    <span style="color:#CCC;"> QQ:</span> {$member.qq}
			    </notempty>
			    <notempty name="member.telephone">
			    <span style="color:#CCC;"> 电话:</span> {$member.telephone}
			    </notempty>
			    <notempty name="member.email">
			    <span style="color:#CCC;"> Email:</span> {$member.email}
			    </notempty>
		    </if>
		    
		    </div>
                </div><!--cell2-->
            </div><!--ctcycell-->
	    </volist>
<notempty name="club.ismanager">
	<?php $showPager(); ?>
</notempty>
        </div><!--stcy left-->
        
        <div class="stcyright">
            <div class="sttttt">待审核会员：</div>
	    <volist name="inactive" id="member">
	    <p>{$member.realname} {$member.dept} {$member.grade}级 {$club.isadmin}
	    <notempty name="club.ismanager">
	    <a href="/Club/joinVerify?gid={$club.gid}&uid={$member.uid}">允许</a> <a href="/Club/joinDeny?gid={$club.gid}&uid={$member.uid}">忽略</a>
	    </notempty>
	    </p>
            </volist>
            
        </div><!--ctcy right-->
        
        
    </div><!--stcon1-->


</div><!--stmain--> 

</body>
</html>
