<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="/static/css1.css" type="text/css" rel="stylesheet" />
<script src="/static/jquery.js" type="text/javascript"></script>
<link href="/static/shetuanxianshi.css" type="text/css" rel="stylesheet" />
<title>社团成员管理</title>
</head>

<body>	
<include file="Public:headnav" />

<notempty name="club.isadmin">
<script>
    function ajaxChangeTitle(uid, priv, title) {
        if (title.length < 1)
		return;
    	$.ajax({
		url: "/Club/changeTitle",
		data: {uid: uid, gid: <?=$club['gid']?>, title: title, priv: priv}
	}).done(function(obj){
		dom = $("#stcy"+uid).children('.stcycell2').children('.stzhiwu');
		dom.children('img').attr("src", "/static/images/aa"+
			function() {
			switch(priv) {
			case 'admin': return 1;
			case 'manager': return 2;
			case 'member': return 3;
			case 'inactive': return 4;
			default: return 4;
			}
			}()
			+".png"
		);
		dom.children('.stzhiwumc').html(title);
	});
    }
</script>		
</notempty>

<notempty name="club.ismanager">
<?php
$showPager = function() use($club) {
	if ($club['ismanager'])
	if ($club['memberCount'] > 20) {
?>
<div class="pager">
 <table border="0" cellpadding="0" cellspacing="0" align="center" style="margin:0 auto;">
 <tr>
 <td style="color:#DDDDDD;" width="46">page</td>
<?php	$num = floor(($club['memberCount'] + 19) / 20);
	for ($page=1; $page<=$num; $page++) { ?>
<td width="20" align="center"><?php echo $pageNow."*****";?><if condition="$page eq $pageNow"><span><?=$page?></span><else /><a href="/Club/manage?gid=<?=$club['gid']?>&page=<?=$page?>"><?=$page?></a></if></td>
<?php	} ?>
 <td style="color:#DDDDDD;" width="46">page</td>
 </tr>
 </table>
</div>
<?php
	}
};
?>
</notempty>
<div id="stmain">
<include file="introHeaderin" />
	<div class="stcon1">
    	<div class="stcylb">会员<span class="stnotice1">（为保护隐私，普通成员无法看到除了社团管理者之外的会员的联系方式）</span></div>
        <div class="stcyleft">
<notempty name="club.ismanager">
	<?php $showPager(); ?>
</notempty>
	    <volist name="members" id="member">
            <div class="stcycell" id="stcy{$member.uid}">
            	<div class="stcycell1"><img width="90" height="90" src="/{$member.avatar}"></div>
                <div class="stcycell2">
		<?php
		$priv2num = function($priv) {
			switch ($priv) {
			case 'admin': return 1;
			case 'manager': return 2;
			case 'member': return 3;
			default: return 4;
			}
		};
		$member['privlevel'] = $priv2num($member['priv']);
		?>
                    <div class="stzhiwu"><img src="/static/images/aa{$member.privlevel}.png" />
		    <div class="stzhiwumc">{$member.title}</div>
		    
		    <notempty name="club.isadmin">
	    	    <div class="stzhiwusz">设置权限：
                        <select onchange="ajaxChangeTitle({$member.uid}, this.options[this.selectedIndex].getAttribute('priv'), this.options[this.selectedIndex].getAttribute('title'))">
                        <option priv="" title="" selected="selected">------</option>
            
			<option priv="admin" title="会长" style="color:#F00;">会长</option>
			<option priv="admin" title="社长" style="color:#F00;">社长</option>
			<option priv="admin" title="主席" style="color:#F00;">主席</option>
            <option priv="admin" title="队长" style="color:#F00;">队长</option>
			
                        <option priv="" title="">------</option>
                        <option priv="manager" title="副会长" style="color:#F0F">副会长</option>
						<option priv="manager" title="副社长" style="color:#F0F">副社长</option>
						<option priv="manager" title="副主席" style="color:#F0F">副主席</option>
                        <option priv="" title="">------</option>
                        <option priv="manager" title="部长" style="color:#F93">部长</option>
                        <option priv="manager" title="副部长" style="color:#F93">副部长</option>
                        <option priv="manager" title="项目组长" style="color:#F93">项目组长</option>
                        <option priv="manager" title="活动负责人" style="color:#F93">活动负责人</option>
                        
                        <option priv="" title="" >------</option>
                        <option priv="member" title="会员" style="color:#09F;">普通会员</option>
                       
                        <option priv="" title="" >------</option>
			<option priv="inactive" title="待审核">待审核</option>
                	</select>
                    </div>
		    </notempty>

		    <notempty name="club.isSchoolAdmin">
		    <div class="stsetowner">
		    <a href="/Club/addOwnerSubmit?gid={$club.gid}&owner={$member.uid}">设为会长</a>
		    </div>
		    </notempty>

		    </div>
                    <div class="stcyxx"><span class="<?=$member['gender'] ? 'boy' : 'girl' ?>name">{$member.realname}</span>：<br/>
		    {$member.dept} {$member.grade}级 {$member.education} <notempty name="club.ismanager">
		            <notempty name="member.student_no">
			    学号: <span style="color:#999">{$member.student_no}</span>
			    </notempty>
			 </notempty><br/>

		    <if condition="$member[priv] == 'admin' || ($member[priv] == 'manager' && $club[isin]) || $club[ismanager]">
			    <notempty name="member.qq">
			    QQ:  <span style="color:#999">{$member.qq}</span>
			    </notempty>
			    <notempty name="member.telephone">
			    电话:  <span style="color:#999">{$member.telephone}</span>
			    </notempty>
			    <notempty name="member.email">
			    Email:  <span style="color:#999">{$member.email}</span>
			    </notempty>
		    </if>
		    
		    </div>
                </div><!--cell2-->
            </div><!--ctcycell-->
	    </volist>
<notempty name="club.ismanager">
	<?php $showPager(); ?>
</notempty>
        </div><!--stcy left-->
        
        <div class="stcyright">
        <div class="sttttt">功能面板<span class="stxmz11">仅部长及以上权限可见</span></div>
        <notempty name="club.ismanager">       
        	<table cellpadding="0" cellspacing="0" border="0" >
            	<tr >
                	<td align="left" width="200px" ><a target="_blank" href="/Club/sendEmail?gid={$club.gid}"  style="color:#088;">群邮件</a></td>
                    <td align="left"><a href="" style="color:#CCC;">群短信</a></td>
                </tr>
                <tr>
                	<td align="left"><a  style="color:#088;">会员列表</a></td>
                    <td align="left"><a href="/Club/address?gid={$club.gid}" target='_blank' style="color:#088;">通讯录</a></td>
                </tr>
                <tr>
                	<td align="left"><a href="/Club/createAddress?gid={$club.gid}" style="color:#088;">导出为excel会员表</a></td>
                    <td align="left"><a href="/Club/createAddressFetion?gid={$club.gid}" style="color:#088;">导出为飞信联系人</a></td>
                </tr>
                <tr>
                	<td align="left"><a href="/Club/emailAddress?gid={$club.gid}" target='_blank' style="color:#088;">群邮件地址</a></td>
                    <td align="left"><a href="/Club/createAddressEmailUSTC?gid={$club.gid}" style="color:#088;">导出为科大邮件联系人</a></td>
                </tr>
            </table>            
            
         </notempty>   
        <br/>
        <br/>
        <div class="sttttt">待审核会员：</div>
	    <volist name="inactive" id="member">
	        <p><span class="<?=$member['gender'] ? 'boy':'girl'?>name">{$member.realname}</span> {$member.dept} {$member.grade}级{$member.education}
	        <notempty name="club.ismanager">
	        <a href="/Club/joinVerify?gid={$club.gid}&uid={$member.uid}" class="stfjdel1">允许</a> / <a href="/Club/joinDeny?gid={$club.gid}&uid={$member.uid}" class="stfjdel1">拒绝</a>
	        </notempty>
	        </p>
        </volist>
            
        </div><!--ctcy right-->
        
        
    </div><!--stcon1-->


</div><!--stmain--> 

</body>
</html>
