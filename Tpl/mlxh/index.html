<!doctype html>
<html>
  <head>
    <title>美丽邂逅2012</title>
    <meta charset="utf-8">
    <style type="text/css">
      #landing{
        width: 1024px;
        height: 576px;
        background: url("/static/mlxh/img/ml_big.jpg") no-repeat;
        margin: 0 auto;
        margin-top: 30px;
        position: relative;
      }
      #mlxh_content{
        position: absolute;
        top:520px;
        left:100px;
        /*margin-left:-400px; */
      }
      #mlxh_content a{
        text-decoration: none;
        text-align: center;
        font-style: italic;
        font-size: 18px;
        font-family: "微软雅黑";
        padding: 3px;
        height: 25px;
        width:60px;
        display: block;
        border:1px solid #e62589;
        float: left;
        margin-left: 30px;
      }
      #mlxh_content span{
        float: left;
        color:#e62589;
        font-size: 24px;
        font-style: italic;
        margin-left: 30px;
        padding: 3px;
      }
      #mlxh_content a:link{
        background: url("/static/mlxh/img/mlxh_bt1.png");
        background-color:#ffffff;
        color:#e62589; 
      }
      #mlxh_content a:hover{
        background: url("/static/mlxh/img/mlxh_bt2.png");
        color:#ffffff;
        background-color:#e62589; 
      }
      #mlxh_miaosha,#mlxh_choujiang{
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="landing">
    <div id="mlxh_content">
      <a id="mlxh_reg" href="/User/register">注册</a>
      <a id="mlxh_login" href="/User/login">登录</a>
      <a id="mlxh_miaosha" href="#">秒杀</a>
      <a id="mlxh_choujiang" href="#">抽奖</a>
      <span id="daojishi"></span>
    </div>
      
    </div>
    <script src="/static/mlxh/js/jquery.js"></script>
    <script src="/static/mlxh/js/bootstrap.min.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
<?php
    date_default_timezone_set('Asia/Chongqing');
    $t = localtime(time(), true);
?>
		var now = new Date(
            <?=$t['tm_year']+1900?>,
            <?=$t['tm_mon']+1?>,
            <?=$t['tm_mday']?>,
            <?=$t['tm_hour']?>,
            <?=$t['tm_min']?>,
            <?=$t['tm_sec']?>
            );
    var theTime =new Date(now.getFullYear(),now.getMonth(),now.getDay(),12,30,00);
    var isTime = false;
    function CurentTime(){      
      var mm = now.getMinutes();      
      var ss = now.getTime() % 60000;
      ss = (ss - (ss % 1000)) / 1000;      
      var clock = now.getHours() +':';      
      if (mm < 10) clock += '0';     
      clock += mm+':';      
      if (ss < 10) clock += '0'; 
      if(now.getHours()==11){
        
        if (mm>=11) {
          if (mm==11) {
            if(ss>=11){
              isTime = true
            };
          }else{
            isTime = true;
          };
        };
      };   
      return(clock + ss); 
    }
    function leftTime(){
    //  if (now - theTime > 60 * 80) // 11:11 ~ 12:30
    //    return "今天的秒杀已经结束 :)";
      if (now - theTime >= 0)
        return "秒杀已经开始啦，立即抢票";
      var time_now = now.getHours()*3600+now.getMinutes()*60+now.getSeconds();
      var time_up = theTime.getHours()*3600+theTime.getMinutes()*60+theTime.getSeconds();
      var leftH = (time_up-time_now)/3600;
      leftH=Math.floor(leftH);
      var leftM = (time_up-time_now-3600*leftH)/60;
      leftM = Math.floor(leftM);
      var leftS = time_up-time_now-3600*leftH-60*leftM;
      return "距离下一次秒杀还有 "+leftH+"小时"+leftM+"分"+leftS+"秒";
    }  
    function refresh(){      
      // document.getElementById("clock").innerHTML = now.getFullYear()+"年"+now.getMonth()+"月"+now.getDate()+"日 "+ CurentTime();
      if(!isTime){
        document.getElementById("daojishi").innerHTML = leftTime();
      }else{
        $("#mlxh_miaosha").removeClass("disabled");
        $("#mlxh_miaosha").innerHTML = '立即抢票';        
      }
      now.setSeconds(now.getSeconds()+1);
    } 
    setInterval(refresh,1000);        
    
    $("#mlxh_choujiang").css("display","none");
    $("#mlxh_miaosha").css("display","none");
    })

    $('#mlxh_miaosha').click(function(){
        if ($('#miaosha').hasClass('disabled'))
            return;
        $.ajax({
            url: '/mlxh/miaosha',
            dataType: 'json',
            success: function(obj) {
                if(obj.status) {
                    $('#daojishi').html(obj.msg);
                    $('#daojishi').addClass('disabled');
                    clearInterval(intervalId);
                } else {
                    $('#daojishi').html(obj.msg);
                    clearInterval(intervalId);
                }
            },
            error: function(e) {
                $('#daojishi').html("服务器错误，请重试");
                clearInterval(intervalId);
            }
        });
    });
    </script>     
  </body>
</html>
